---
- hosts: all
  become_user: root
  become: yes

  tasks: 
  - name: Eliminar .tar
    shell: find /INSIS_GITRelease/ -user root \( \-name '*.tar' \) -exec rm {} \;

  - name: Delete branch directory
    file:
      path: /INSIS_GITRelease/{{ branch }}
      state: absent
      
  - name: create folder
    file:
      path: /INSIS_GITRelease/{{ branch }}
      state: directory
      owner: root
      group: root
      mode: 0775 

  - name: download branch in folder
    shell:
      cmd: |
        cd /INSIS_GITRelease/{{ branch }}
        git clone --branch release/{{ branch }} {{ URLGIT }} .
          
  - name: compress all the files in tar
    archive:
      path: "/INSIS_GITRelease/{{ branch }}/DB/"
      dest: /INSIS_GITRelease/{{ branch }}/DB/{{ branch }}.tar
      format: tar      